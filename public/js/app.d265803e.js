(function(t){function e(e){for(var a,s,l=e[0],r=e[1],c=e[2],u=0,h=[];u<l.length;u++)s=l[u],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&h.push(n[s][0]),n[s]=0;for(a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a]);d&&d(e);while(h.length)h.shift()();return o.push.apply(o,c||[]),i()}function i(){for(var t,e=0;e<o.length;e++){for(var i=o[e],a=!0,l=1;l<i.length;l++){var r=i[l];0!==n[r]&&(a=!1)}a&&(o.splice(e--,1),t=s(s.s=i[0]))}return t}var a={},n={app:0},o=[];function s(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=a,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],r=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var d=r;o.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},1:function(t,e){},"11f5":function(t,e,i){},"13c0":function(t,e,i){},"1fe8":function(t,e,i){t.exports=i.p+"img/error.a18bc0ce.png"},2008:function(t,e,i){},"2b43":function(t,e,i){},"498f":function(t,e,i){"use strict";var a=i("d289"),n=i.n(a);n.a},"56d7":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var a=i("2b0e"),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("transition",{attrs:{name:"fade",mode:"out-in"}},[i("router-view")],1)],1)},o=[],s=(i("5c0b"),i("0c7c")),l={},r=Object(s["a"])(l,n,o,!1,null,null,null),c=r.exports,d=i("8c4f"),u=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-row",{staticClass:"container"},[i("el-col",{staticClass:"header",attrs:{span:24}},[i("el-col",{attrs:{span:12}},[i("div",{staticClass:"main_content"},[i("span",{staticClass:"logo",staticStyle:{"font-size":"30px","font-family":"'Noto Sans Old South Arabian'"}},[i("b",[t._v("JOYEA")])]),i("span",{staticClass:"logo",staticStyle:{"font-size":"15px","margin-left":"5px"}},[t._v("仅一素材库")])])]),i("el-col",{staticClass:"userinfo",attrs:{span:12}},[i("el-button",{class:{"is-active":"/build"===t.currentPath},attrs:{size:"small",icon:"el-icon-edit"},on:{click:t.jumpToBuild}},[t._v(" 工作台 ")]),i("el-button",{class:{"is-active":"/manage/list"===t.currentPath},staticStyle:{"margin-right":"10px"},attrs:{size:"small",icon:"el-icon-tickets"},on:{click:t.jumpToList}},[t._v("我的清单 ")]),i("el-popover",{staticStyle:{"margin-right":"20px"},attrs:{placement:"bottom-start",width:"550",trigger:"click"},on:{show:t.handleOpenDownload,hide:t.handleCloseDownload}},[i("el-table",{attrs:{data:t.downloadTask,"empty-text":"今日暂无下载任务"}},[i("el-table-column",{attrs:{width:"300",label:"任务名称","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.opened?i("div",{staticStyle:{color:"#888888"}},[t._v(" "+t._s(e.row.firstSrcName)+" ")]):i("div",{staticStyle:{color:"#000000"}},[t._v(" "+t._s(e.row.firstSrcName)+" ")])]}}])}),i("el-table-column",{attrs:{width:"150",property:"startTime",label:"下载时间"}}),i("el-table-column",{attrs:{width:"100",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:e.row.status?"success":"danger",size:"mini",icon:e.row.status?"el-icon-download":"el-icon-loading"},on:{click:function(i){return t.handleDownload(e.row)}}})]}}])})],1),i("el-button",{attrs:{slot:"reference",size:"small",circle:"",type:t.visible?"danger":"",icon:t.visible?"el-icon-loading":"el-icon-download"},slot:"reference"})],1),i("el-dropdown",{attrs:{trigger:"hover"}},[i("span",{staticClass:"el-dropdown-link userinfo-inner"},[t._v(t._s(t.userInfo.name))]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{nativeOn:{click:function(e){return t.logout(e)}}},[t._v("注销登陆")])],1)],1)],1)],1),i("el-col",{staticClass:"main",attrs:{span:24}},[i("section",{staticClass:"content-container"},[i("div",{staticClass:"grid-content bg-purple-light"},[i("el-col",{staticClass:"content-wrapper",attrs:{span:24}},[i("transition",{attrs:{name:"fade",mode:"out-in"}},[i("router-view")],1)],1)],1)])])],1)],1)},h=[],p=(i("4160"),i("c975"),i("baa5"),i("ac1f"),i("5319"),i("159b"),i("bc3a")),m=i.n(p),f=m.a.create({timeout:36e5});function g(t){return f.post("api",t).then((function(t){return t.data}))}function v(t,e){return f.post("api/v1/user/login",{user:t,pwd:e}).then((function(t){return t.data}))}function b(){return f.post("api/v1/user/logout",{}).then((function(t){return t.data}))}function y(){return f.post("api/v1/user/check",{}).then((function(t){return t.data}))}function w(t){return f.post("api/v1/album/download/record",{albumId:t}).then((function(t){return t.data}))}function _(){return f.post("api/v1/search/key/top",{}).then((function(t){return t.data}))}function S(){var t=new Date,e="-",i=t.getFullYear(),a=t.getMonth()+1,n=t.getDate();return a>=1&&a<=9&&(a="0"+a),n>=0&&n<=9&&(n="0"+n),i+e+a+e+n}var x=i("2f62"),C={barVisible:!1},k={SET_VISIBLE:function(t,e){console.log(e),t.barVisible=e}},D={setVisible:function(t,e){var i=t.commit;console.log(e),i("SET_VISIBLE",e)},openVisible:function(t){var e=t.commit;e("SET_VISIBLE",!0)},closeVisible:function(t){var e=t.commit;e("SET_VISIBLE",!1)}},I={namespaced:!0,state:C,mutations:k,actions:D},L={userName:"",sessionId:""},$={},P={},T={namespaced:!0,state:L,mutations:$,actions:P};a["default"].use(x["a"]);var V=new x["a"].Store({modules:{downloadStatus:I,UserInfo:T},getters:{barVisible:function(t){return t.downloadStatus.barVisible}}}),O=V,A=window.localStorage,E=0,N={data:function(){return{userInfo:{name:"",email:""},currentPath:"",downloadTask:[]}},computed:{visible:function(){return O.getters.barVisible}},methods:{jumpToBuild:function(){this.$router.replace("/build")},jumpToList:function(){this.$router.replace("/manage/list")},handleOpen:function(){},handleClose:function(){},handleSelect:function(t,e){},logout:function(){var t=this;this.$confirm("确认退出吗?","提示",{}).then((function(){t.$router.push("/login"),b().then((function(t){}))})).catch((function(){}))},handleOpenDownload:function(){var t=this;g({action:"todayDownloadList"}).then((function(e){t.downloadTask=[],e.task.forEach((function(e){t.downloadTask.push({id:e.id,startTime:e.startTime,firstSrcName:e.firstSrcName.substr(0,e.firstSrcName.lastIndexOf(".")),status:0!==e.finishTime.length,opened:t.handleQueryRecord(e.id)})})),t.downloadTask.reverse()})),E=setInterval((function(){g({action:"todayDownloadList"}).then((function(e){t.downloadTask=[],e.task.forEach((function(e){t.downloadTask.push({id:e.id,startTime:e.startTime,firstSrcName:e.firstSrcName.substr(0,e.firstSrcName.lastIndexOf(".")),status:0!==e.finishTime.length,opened:t.handleQueryRecord(e.id)})})),t.downloadTask.reverse(),console.log(t.downloadTask)}))}),2e3)},handleQueryRecord:function(t){var e=A.getItem(this.genTodayDownloadTaskKey());return!(null==e||-1===JSON.parse(e).indexOf(t))},handleAddRecord:function(t){var e=A.getItem(this.genTodayDownloadTaskKey());if(null==e){var i=[];i[0]=t,A.setItem(this.genTodayDownloadTaskKey(),JSON.stringify(i))}else{var a=JSON.parse(e);a[a.length]=t,A.setItem(this.genTodayDownloadTaskKey(),JSON.stringify(a))}},handleCloseDownload:function(){clearInterval(E)},handleDownload:function(t){t.status&&(this.handleAddRecord(t.id),window.open(window.location.protocol+"//"+window.location.host+"/download/"+t.id+"/"+t.firstSrcName))},genTodayDownloadTaskKey:function(){return"down_open_"+S()}},watch:{$route:function(t,e){this.currentPath=this.$router.currentRoute.fullPath}},mounted:function(){var t=this;this.currentPath=this.$router.currentRoute.fullPath,this.$route.params.checked||y().then((function(e){4001===e.code&&(t.$router.push("/login"),t.$message.error("登录信息已过期，请重新登陆！"))}));var e=A.getItem("userInfo");e?this.userInfo=JSON.parse(e):this.$router.push("/login")}},M=N,j=(i("ba2a"),Object(s["a"])(M,u,h,!1,null,"8d3555fc",null)),F=j.exports,z=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-form",{ref:"loginForm",staticClass:"demo-ruleForm login-container",attrs:{model:t.loginForm,rules:t.loginRule,"label-position":"left","label-width":"0px"}},[i("h3",{staticClass:"title"},[t._v("仅一素材库系统")]),i("el-form-item",{attrs:{prop:"user"}},[i("el-input",{attrs:{type:"text","auto-complete":"off",placeholder:"工号"},model:{value:t.loginForm.user,callback:function(e){t.$set(t.loginForm,"user",e)},expression:"loginForm.user"}})],1),i("el-form-item",{attrs:{prop:"pwd"}},[i("el-input",{attrs:{type:"password","auto-complete":"off",placeholder:"密码"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleLogin(e)}},model:{value:t.loginForm.pwd,callback:function(e){t.$set(t.loginForm,"pwd",e)},expression:"loginForm.pwd"}})],1),i("el-checkbox",{staticClass:"remember",attrs:{checked:""},model:{value:t.loginForm.rememberPwd,callback:function(e){t.$set(t.loginForm,"rememberPwd",e)},expression:"loginForm.rememberPwd"}},[t._v("记住密码")]),i("el-form-item",{staticStyle:{width:"100%"}},[i("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",loading:t.loginLoading},nativeOn:{click:function(e){return e.preventDefault(),t.handleLogin(e)}}},[t._v("登录 ")])],1)],1)},B=[],R=window.localStorage,W={data:function(){return{systemTitle:"仅一素材库系统",loginLoading:!1,loginForm:{user:"",pwd:"",rememberPwd:!0},loginRule:{user:[{required:!0,message:"请输入工号",trigger:"blur"}],pwd:[{required:!0,message:"请输入密码",trigger:"blur"}]}}},methods:{handleLogin:function(t){var e=this;this.$refs.loginForm.validate((function(t){if(!t)return e.$message.error("请检查用户密码是否规范！"),!1;e.loginLoading=!0,v(e.loginForm.user,btoa(e.loginForm.pwd)).then((function(t){if(e.loginLoading=!1,2e3===t.code)if(e.$message.success("登陆成功,【"+t.data.userName+"】欢迎您回来！"),e.loginForm.rememberPwd?R.setItem("u",btoa(JSON.stringify(e.loginForm))):R.removeItem("u"),R.setItem("userInfo",JSON.stringify({session:t.data["session"],name:t.data["userName"],email:e.loginForm.user})),e.$route.query.ref){var i=JSON.parse(atob(e.$route.query.ref));i.fromShare?e.$router.push({name:"share",query:{albumId:i.albumId}}):e.$router.push({name:"build",params:{checked:!0}})}else e.$router.push({name:"build",params:{checked:!0}});else e.$message.error("登陆失败，请检查用户名密码！")}))}))}},mounted:function(){var t=R.getItem("u");t&&(this.loginForm=JSON.parse(atob(t)))}},J=W,K=(i("498f"),Object(s["a"])(J,z,B,!1,null,"e851241e",null)),G=K.exports,q=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",[i("div",{staticStyle:{padding:"10px 35px 0 150px",background:"#1e162f"}},[i("el-input",{staticClass:"my-input",attrs:{placeholder:"请输入关键字"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearch(e)}},model:{value:t.search.key,callback:function(e){t.$set(t.search,"key",e)},expression:"search.key"}},[i("el-button",{staticClass:"search-button",staticStyle:{"border-radius":"100px"},attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.handleSearch},slot:"append"})],1),i("div",{staticStyle:{padding:"15px 0",color:"#ffffff"}},[t._v("热门搜索: "),t._l(t.topSearchKey,(function(e){return i("span",{staticStyle:{padding:"5px"},on:{click:function(i){return t.handleClickTopSearchKey(e)}}},[i("u",[t._v(t._s(e))])])}))],2)],1),1===t.dir.currentPath.length&&"营销素材展示"===t.dir.currentPath[0]&&0===t.toCreateAlbum.list.length?i("div",{staticStyle:{height:"1080px"}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.dir.loadingDir||t.loading.search,expression:"dir.loadingDir || loading.search"}],staticStyle:{padding:"10px 10px 0 10px",background:"#d1d1d1",height:"100%"}},[i("el-row",{attrs:{gutter:10,justify:"center",align:"middle"}},t._l(t.menuPath,(function(e){return i("el-col",{attrs:{xs:24,sm:12,md:8,lg:6,xl:6}},[i("div",{staticClass:"menu-content",staticStyle:{border:"#000000 3px"},on:{click:function(i){return t.handleClickRootMenu(e)}}},[i("img",{staticStyle:{"max-width":"120px",height:"100px",padding:"30px 20px 10px 20px"},attrs:{src:e.icon}}),i("div",{staticStyle:{padding:"30px",height:"30px","font-size":"18px"}},[t._v(t._s(e.name))])])])})),1)],1)]):i("el-row",{staticStyle:{padding:"10px 35px 0 150px"},attrs:{gutter:20}},[i("el-col",{staticClass:"bg-purple",attrs:{span:18}},[i("el-row",{staticClass:"contentHead"},[i("el-col",{attrs:{span:18}},[i("span",{staticStyle:{color:"#66b1ff","font-size":"15px",cursor:"pointer"},on:{click:function(e){return t.handleListLenovoDir("/营销素材展示","ent")}}},[t._v("首页")]),t._l(t.dir.currentPath,(function(e,a){return"营销素材展示"!==e?i("span",{staticStyle:{display:"inline"}},[t._v(" / "),i("span",{staticStyle:{color:"#66b1ff","font-size":"15px",cursor:"pointer"},on:{click:function(i){return t.handleClickDirPath(e,a)}}},[t._v(t._s(e))])]):t._e()}))],2),i("el-col",{attrs:{span:3,offset:3}},[t._v(" 共"+t._s(t.dir.tableData.length)+"个资源 ")])],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.dir.loadingDir||t.loading.search,expression:"dir.loadingDir || loading.search"}],ref:"fileTable",staticStyle:{width:"100%"},attrs:{data:t.dir.tableData,"tooltip-effect":"dark","empty-text":"文件夹为空"},on:{"row-click":t.handleClickDirItem}},[i("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"文件名"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{staticStyle:{"font-size":"18px"}},[e.row.is_dir?i("i",{staticClass:"el-icon-folder-opened"}):e.row.mime_type.startsWith("video")?i("i",{staticClass:"el-icon-video-camera"}):e.row.mime_type.startsWith("image")?i("img",{staticStyle:{width:"60px",height:"60px","line-height":"30px"},attrs:{src:t.genPreviewUrl(e.row.neid,e.row.hash,e.row.rev,e.row.mime_type)}}):e.row.mime_type.startsWith("doc")?i("i",{staticClass:"el-icon-tickets"}):i("i",{staticClass:"el-icon-question"}),i("span",{staticStyle:{"vertical-align":"top"}},[t._v(" "+t._s(" "+e.row.path.substr(e.row.path.lastIndexOf("/")+1)))]),e.row.tags?i("div",t._l(e.row.tags,(function(e){return i("el-tag",{staticStyle:{"margin-right":"2px"},attrs:{type:"success",size:"mini"}},[t._v(t._s(e)+" ")])})),1):t._e()])]}}])}),i("el-table-column",{attrs:{label:"引用次数",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(e.row.is_dir?"-":e.row.ref_num))])]}}])}),i("el-table-column",{attrs:{label:"下载次数",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(e.row.is_dir?"-":e.row.download_num))])]}}])}),i("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.is_dir?i("span",[t._v("-")]):i("span",[i("el-button",{attrs:{circle:"",type:"primary",icon:"el-icon-plus"},on:{click:function(i){return i.stopPropagation(),t.handleAdd(e.$index,e.row)}}})],1)]}}])})],1)],1),i("el-col",{staticClass:"bg-purple",attrs:{span:6}},[i("div",{staticClass:"content_div"},[i("div",{staticClass:"center_vertical",staticStyle:{width:"100%"}},[i("h1",[t._v("清单编辑列表（"+t._s(t.toCreateAlbum.list.length)+"）")])]),i("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{stripe:"","empty-text":"清单内还没有内容","row-key":"neid",id:"toSortTable",data:t.toCreateAlbum.list}},[i("el-table-column",{attrs:{label:"预览"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.row.path,placement:"top"}},[e.row.mime_type.startsWith("video")?i("img",{staticClass:"preview_img",attrs:{src:"video.png"},on:{click:function(i){return t.handleGoToPreview(e.row)}}}):e.row.mime_type.startsWith("doc")?i("img",{staticClass:"preview_img",attrs:{src:t.handleGetDocumentImage(e.row.mime_type)},on:{click:function(i){return t.handleGoToPreview(e.row)}}}):e.row.mime_type.startsWith("image")?i("img",{staticClass:"preview_img",attrs:{onerror:t.defaultImg,preview:"buildList","preview-text":e.row.path,src:t.genPreviewUrl(e.row.neid,e.row.hash,e.row.rev,e.row.mime_type)}}):i("img",{staticClass:"preview_img",attrs:{src:"unknown.png"},on:{click:function(i){return t.handleGoToPreview(e.row)}}})])]}}])}),i("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isModify?i("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(i){return i.stopPropagation(),t.handleModify(e.$index,e.row,!1)}}},[t._v("取消 ")]):i("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(i){return i.stopPropagation(),t.handleDelete(e.$index,e.row)}}},[t._v("删除 ")])]}}])})],1),i("el-row",{staticClass:"load_more_bt",class:{no_display:0===t.toCreateAlbum.list.length},attrs:{gutter:5}},[i("el-col",{attrs:{span:8}},[i("el-button",{staticClass:"load_more_bt",attrs:{type:"primary",icon:"el-icon-folder-add",loading:t.loading.saveList},on:{click:function(e){return e.stopPropagation(),t.handleSaveList(e)}}},[t._v("保存清单 ")])],1),i("el-col",{attrs:{span:8}},[i("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.loading.fullscreenLoading,expression:"loading.fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"load_more_bt",attrs:{type:"success",icon:"el-icon-suitcase"},on:{click:function(e){return e.stopPropagation(),t.handleDownloadSrc(!0)}}},[t._v("下载准备 ")])],1),i("el-col",{attrs:{span:8}},[i("el-button",{staticClass:"load_more_bt",attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(e){return e.stopPropagation(),t.handleClearList(e)}}},[t._v("清空 ")])],1)],1)],1)])],1),i("el-dialog",{ref:"addDialog",attrs:{title:"选择已有解说词",visible:t.toCreateAlbum.descSelectDialogVisible,center:""},on:{"update:visible":function(e){return t.$set(t.toCreateAlbum,"descSelectDialogVisible",e)}}},[i("span",{staticClass:"dialog-footer"},[i("img",{staticClass:"preview_img",staticStyle:{margin:"0 auto"},attrs:{src:t.toCreateAlbum.previewUrl}})]),i("el-table",{staticStyle:{width:"70%"},attrs:{data:t.toCreateAlbum.toSelectDesc,"empty-text":"暂无可用解说词"},on:{"row-click":t.handleSelectDesc}},[i("el-table-column",{attrs:{prop:"desc"}})],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary",icon:"el-icon-circle-plus"},on:{click:function(e){return e.stopPropagation(),t.handleCustomDesc(e)}}},[t._v("不借鉴")])],1)],1),i("el-dialog",{attrs:{title:"【"+t.selectListName+"】清单详情",visible:t.visible.listDetailDialogVisible},on:{"update:visible":function(e){return t.$set(t.visible,"listDetailDialogVisible",e)}}},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.listDetailLoading,expression:"loading.listDetailLoading"}],attrs:{data:t.listDetail},on:{"selection-change":t.handleSelectListItem}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),i("el-table-column",{attrs:{label:"预览"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.row.path,placement:"top"}},[i("img",{staticClass:"preview_img",attrs:{onerror:t.defaultImg,src:t.genPreviewUrl(e.row.neid,e.row.hash,e.row.rev,e.row.mime_type)}})])]}}])})],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){e.stopPropagation(),t.visible.listDetailDialogVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary",disabled:0===t.selectListItem.length},on:{click:function(e){return e.stopPropagation(),t.handleAddListDetailToBuild(e)}}},[t._v("添 加 ")])],1)],1),i("el-dialog",{attrs:{title:t.toPlayVideo.title,visible:t.visible.videoDialogVisible},on:{"update:visible":function(e){return t.$set(t.visible,"videoDialogVisible",e)},close:t.handleCloseVideo,opened:function(e){return t.playVideo()}}},[i("video",{staticClass:"video-js vjs-big-play-centered vjs-fluid",attrs:{id:"myVideo",oncontextmenu:"return false"}},[i("p",{staticClass:"vjs-no-js"},[t._v(" To view this video please enable JavaScript, and consider upgrading to a web browser that "),i("a",{attrs:{href:"https://videojs.com/html5-video-support/",target:"_blank"}},[t._v(" supports HTML5 video ")])])])]),i("el-dialog",{attrs:{title:t.toPlayImage.title,visible:t.visible.imageDialogVisible},on:{"update:visible":function(e){return t.$set(t.visible,"imageDialogVisible",e)},close:t.handleCloseImage}},[i("el-image",{attrs:{src:t.toPlayImage.url}},[i("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[i("i",{staticClass:"el-icon-picture-outline"})])])],1),i("el-dialog",{attrs:{title:"【"+t.search.key+"】的搜索结果",visible:t.visible.searchDialogVisible},on:{"update:visible":function(e){return t.$set(t.visible,"searchDialogVisible",e)},close:function(t){}}},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.search,expression:"loading.search"}],staticStyle:{width:"100%"},attrs:{stripe:"","empty-text":"暂没有搜索数据",data:t.searchResult,height:"500"},on:{"row-click":t.handleClickSearch}},[i("el-table-column",{attrs:{label:"素材名","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{on:{click:function(i){return t.handleGoToPreview(e.row)}}},[i("h4",{staticStyle:{margin:"2px"}},[e.row.is_dir?i("i",{staticClass:"el-icon-folder-opened"}):e.row.mime_type.startsWith("video")?i("i",{staticClass:"el-icon-video-camera"}):e.row.mime_type.startsWith("image")?i("i",{staticClass:"el-icon-picture-outline"}):e.row.mime_type.startsWith("doc")?i("i",{staticClass:"el-icon-tickets"}):i("i",{staticClass:"el-icon-question"}),t._v(" "+t._s(e.row.path.substr(e.row.path.lastIndexOf("/")+1)))]),e.row.tags?i("div",t._l(e.row.tags,(function(e){return i("el-tag",{staticStyle:{"margin-right":"2px"},attrs:{type:"success",size:"mini"}},[t._v(t._s(e)+" ")])})),1):t._e()])]}}])}),i("el-table-column",{attrs:{label:"引用次数",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(e.row.is_dir?"-":e.row.ref_num))])]}}])}),i("el-table-column",{attrs:{label:"下载次数",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(e.row.is_dir?"-":e.row.download_num))])]}}])}),i("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.is_dir?i("div",[i("el-button",{attrs:{circle:"",type:"primary",icon:"el-icon-folder-opened"},on:{click:function(i){return i.stopPropagation(),t.handleClickDirItem(e.row)}}})],1):i("div",[i("el-button",{attrs:{circle:"",type:"primary",icon:"el-icon-plus"},on:{click:function(i){return i.stopPropagation(),t.handleAdd(e.$index,e.row)}}})],1)]}}])})],1),i("el-button",{staticClass:"load_more_bt",class:{no_display:!t.search.hasNext},attrs:{loading:t.loading.searchMore},on:{click:function(e){return e.stopPropagation(),t.handleLoadMore(e)}}},[t._v("加载更多 ")])],1)],1)},U=[],H=(i("a434"),i("b0c0"),i("b680"),i("d3b7"),i("25f0"),i("841c"),i("1276"),i("2ca0"),i("498a"),i("b85c"));function Q(t,e,i,a,n){return"https://console.box.lenovo.com/v2/preview_router?type="+a+"&root=databox&path=&path_type=ent&from=&neid="+t+"&hash="+e+"&rev="+i+"&X-LENOVO-SESS-ID="+n+"&xxoo="+(new Date).getTime()}var Y=i("aa47"),X=i("f0e2");i("8a79");function Z(t){var e="document.png";return t.endsWith("pdf")?e="pdf.png":t.endsWith("ppt")||t.endsWith("pptx")?e="ppt.png":t.endsWith("doc")?e="docm.png":t.endsWith("xlsx")&&(e="xlsx.png"),e}var tt={name:"index",components:{},data:function(){return{dir:{currentPath:[],tableData:[],loadingDir:!1},searchTabName:"dir",search:{type:"",key:"",hasNext:!1},userInfo:{},loading:{search:!1,searchMore:!1,searchList:!1,saveList:!1,fullscreenLoading:!1,listDetailLoading:!1},menuPath:[{name:"STICK线",path:"STICK线",icon:"menu-icon/1.png"},{name:"听装线",path:"听装线",icon:"menu-icon/2.png"},{name:"软双铝线",path:"软双铝线",icon:"menu-icon/3.png"},{name:"制粒线",path:"制粒线",icon:"menu-icon/4.png"},{name:"泡罩线",path:"泡罩线",icon:"menu-icon/5.png"},{name:"公司介绍",path:"公司介绍",icon:"menu-icon/6.png"},{name:"同行信息",path:"同行信息",icon:"menu-icon/7.png"}],searchResult:[],searchListResult:[],selectListId:0,selectListName:0,selectListItem:[],listDetail:[],topSearchKey:[],toCreateAlbum:{idEditMode:!1,editListId:-1,name:"",list:[],modifyRow:"",toAddRow:{},previewUrl:"",descSelectDialogVisible:!1,toSelectDesc:[]},loadMoreForm:{key:"",nextOffset:0},visible:{listDetailDialogVisible:!1,videoDialogVisible:!1,imageDialogVisible:!1,searchDialogVisible:!1},defaultImg:'this.src="'+i("1fe8")+'"',player:null,toPlayVideo:{title:"",url:""},toPlayImage:{title:"",url:""}}},methods:{handleClickRootMenu:function(t){this.handleListLenovoDir("/营销素材展示/"+t.path,"ent")},handleClickTopSearchKey:function(t){this.handleSearch(t)},handleGetDocumentImage:function(t){return Z(t)},handlePlayVideo:function(t,e){this.visible.videoDialogVisible=!0,this.toPlayVideo.url=t,this.toPlayVideo.title=e},handlePlayImage:function(t,e){this.visible.imageDialogVisible=!0,this.toPlayImage.url=t,this.toPlayImage.title=e},playVideo:function(){var t=this;if(null==this.player)Object(X["a"])(document.getElementById("myVideo"),{controls:!0,preload:"auto",autoplay:!1,fluid:!0,language:"zh-CN",muted:!1,inactivityTimeout:!1,controlBar:{children:[{name:"playToggle"},{name:"currentTimeDisplay"},{name:"progressControl"},{name:"durationDisplay"},{name:"volumePanel",inline:!1},{name:"FullscreenToggle"}]},sources:[{src:t.toPlayVideo.url,type:"video/mp4"}]},(function(){t.player=this}));else{var e={src:t.toPlayVideo.url,type:"video/mp4"};this.player.pause(),this.player.src(e),this.player.load(e),this.player.play()}},handleCloseVideo:function(){null!=this.player&&this.player.pause()},handleCloseImage:function(){this.toPlayImage.url=""},handleSelectListItem:function(t){this.selectListItem=t},handleAddListDetailToBuild:function(){var t=this;this.selectListItem.forEach((function(e){t.toCreateAlbum.list.push({joyeaDesc:e.desc,path:e.path,neid:e.neid,hash:e.hash,rev:e.rev,mime_type:e.mime_type,filename:e.path.substr(e.path.lastIndexOf("/")+1),bytes:e.bytes,isModify:!1})})),g({action:"referList",albumId:this.selectListId}).then((function(t){t.result||console.log("引用计数失败："+t.msg)})),this.visible.listDetailDialogVisible=!1},handleSeeListDetail:function(t){var e=this;this.visible.listDetailDialogVisible=!0,this.loading.listDetailLoading=!0,this.listDetail=[],this.selectListItem=[],this.selectListId=t.album_id,this.selectListName=t.album_name,g({action:"listDetail",albumId:t.album_id}).then((function(t){t.result?t.list.forEach((function(t){e.listDetail.push(t)})):(_this.$notify.error({title:"查看出错",message:"查看过程出现错误："+t.msg}),console.log(t.msg)),e.loading.listDetailLoading=!1}))},handleSearch:function(t){var e=this;void 0!==t&&"string"==typeof t&&(e.search.key=t),0===e.search.key.trim().length?e.$message.warning("请输入搜索的关键字！"):"list"===e.searchTabName?(e.loading.searchList=!0,g({action:"searchList",searchKey:_searchKey}).then((function(t){e.loading.searchList=!1,t.result?(e.searchListResult=[],0===t.list.length?e.$message.error("没有搜索到与【"+e.search.key+"】有关的清单！"):t.list.forEach((function(t){e.searchListResult.push(t)}))):(e.$notify.error({title:"搜索出错",message:"搜索过程出现错误："+t.msg}),console.log(t.msg))})),e.searchTabName="list"):(e.loading.search=!0,g({action:"search",searchKey:e.search.key,offset:0}).then((function(t){t.result?(e.search.hasNext=t["has_more"],e.search.hasNext&&(e.loadMoreForm.key=e.search.key,e.loadMoreForm.nextOffset=t["next_offset"]),e.searchResult=[],0===t.content.length?e.$message.error("没有搜索到与【"+e.search.key+"】有关的文件或文件夹！"):(e.visible.searchDialogVisible=!0,t.content.forEach((function(t){t.joyeaDesc="",t.isModify=!1,e.searchResult.push(t)})))):(e.$notify.error({title:"搜索出错",message:"搜索过程出现错误："+t.msg}),console.log(t.msg))})).finally((function(){e.loading.search=!1})),e.searchTabName="pan")},handleLoadMore:function(){var t=this;0!==t.loadMoreForm.key.trim().length&&(t.loading.searchMore=!0,g({action:"search",searchKey:t.loadMoreForm.key,searchType:t.loadMoreForm.type,offset:t.loadMoreForm.nextOffset}).then((function(e){e.result?(t.search.hasNext=e["has_more"],t.search.hasNext&&(t.loadMoreForm.key=t.search.key,t.loadMoreForm.nextOffset=e["next_offset"]),e.content.forEach((function(e){e.joyeaDesc="",e.isModify=!1,t.searchResult.push(e)}))):(t.$notify.error({title:"搜索出错",message:"搜索过程出现错误："+e.msg}),console.log(e.msg))})).finally((function(){t.loading.searchMore=!1})))},handleAdd:function(t,e){var i=this,a=!1;this.toCreateAlbum.list.forEach((function(t){t.neid===e.neid&&(a=!0)})),a?this.$confirm("编辑列表中已经存在该记录，是否继续添加?","提示",{confirmButtonText:"继续添加",cancelButtonText:"取消添加",type:"warning"}).then((function(){i.toCreateAlbum.list.push(e)})).catch((function(){i.$message({type:"info",message:"取消添加"})})):this.toCreateAlbum.list.push(e)},handleSelectDesc:function(t,e,i){this.toCreateAlbum.toAddRow.joyeaDesc=t.desc,this.toCreateAlbum.list.push(this.toCreateAlbum.toAddRow),this.toCreateAlbum.toAddRow={},this.toCreateAlbum.toSelectDesc=[],this.toCreateAlbum.descSelectDialogVisible=!1},handleCustomDesc:function(){this.toCreateAlbum.toAddRow.joyeaDesc="",this.toCreateAlbum.list.push(this.toCreateAlbum.toAddRow),this.toCreateAlbum.toAddRow={},this.toCreateAlbum.toSelectDesc=[],this.toCreateAlbum.descSelectDialogVisible=!1},handleCollect:function(t,e){var i=this;g({action:"srcCollect",method:e.collect?"unCollect":"collect",neid:e.neid,path:e.path,type:e.mime_type,hash:e.hash,rev:e.rev,size:e.size}).then((function(t){t.result?(e.collect=!e.collect,i.$notify.success({type:"success",title:"提示",message:e.collect?"收藏成功:"+e.path.substr(e.path.lastIndexOf("/")+1):"取消收藏成功:"+e.path.substr(e.path.lastIndexOf("/")+1)})):console.log(t.msg)}))},handleModify:function(t,e,i){var a,n=Object(H["a"])(this.toCreateAlbum.list);try{for(n.s();!(a=n.n()).done;){var o=a.value;if(o.isModify&&o.path!==e.path)return this.$message.warning("请先保存当前编辑项"),!1}}catch(s){n.e(s)}finally{n.f()}return i?(e.isModify?(this.toCreateAlbum.list[t].joyeaDesc=this.toCreateAlbum.modifyRow.joyeaDesc,e.isModify=!1):(this.toCreateAlbum.modifyRow=JSON.parse(JSON.stringify(e)),e.isModify=!0),!1):(this.toCreateAlbum.modifyRow.path,e.isModify=!e.isModify)},handleDelete:function(t,e){this.toCreateAlbum.list.splice(t,1)},genPreviewUrl:function(t,e,i,a){var n="pic";return a.startsWith("doc")?n="doc":a.startsWith("video")&&(n="av"),Q(t,e,i,n,this.userInfo.session)},handleSaveList:function(){var t=this;this.$prompt(this.toCreateAlbum.idEditMode?"当前是编辑模式，重命名清单名称！":"请输入要保存的清单的名称",this.toCreateAlbum.idEditMode?"编辑提示":"保存提示",{confirmButtonText:this.toCreateAlbum.idEditMode?"重新保存":"保存清单",cancelButtonText:"取消",inputValue:this.toCreateAlbum.name}).then((function(e){var i=e.value;t.loading.saveList=!0,g({action:"album",method:t.toCreateAlbum.idEditMode?"reSave":"save",id:t.toCreateAlbum.editListId,name:i,src:t.toCreateAlbum.list}).then((function(e){e.result?t.$notify.success({title:t.toCreateAlbum.idEditMode?"编辑结果":"保存结果",message:t.toCreateAlbum.idEditMode?"重新保存成功":"保存成功"}):(console.log(e.msg),t.$notify.error({title:"保存结果",message:t.toCreateAlbum.idEditMode?"重新保存失败":"保存失败"})),t.loading.saveList=!1,t.$router.push("/manage/list")}))})).catch((function(){t.$message({type:"info",message:"取消保存"})}))},handleClearList:function(){var t=this;this.$alert("当前列表还没有保存，确定清空吗？","清空提示",{confirmButtonText:"确定",callback:function(e){t.toCreateAlbum.list=[]}})},handleGoToPreview:function(t){var e="pic";t.mime_type.startsWith("doc")?e="doc":t.mime_type.startsWith("video")&&(e="av");var i=Q(t.neid,t.hash,t.rev,e,this.userInfo.session);t.mime_type.startsWith("video")?this.handlePlayVideo(i,t.path.substr(t.path.lastIndexOf("/")+1)):t.mime_type.startsWith("image")?this.handlePlayImage(i,t.path.substr(t.path.lastIndexOf("/")+1)):t.mime_type.startsWith("doc")?window.open(i):this.$message.error("暂不支持的预览类型！")},handleDownloadSrc:function(t,e){var i=this,a=this,n=[],o=0;if(t){var s=0;this.toCreateAlbum.list.forEach((function(t){o+=t.bytes,n.push({index:s+=1,filename:t.path.substr(t.path.lastIndexOf("/")+1),rev:t.rev,neid:t.neid.toString(),path:t.path.replace("+","%2b"),path_type:t.path_type})}))}else n.push({filename:e.path.substr(e.path.lastIndexOf("/")+1),rev:e.rev,neid:e.neid.toString(),path_type:e.path_type});var l=o/1024,r=l/1024,c=300;this.$confirm("您已选中【 "+n.length+" 】个文件，"+(r>c?"待准备文件列表大小为【 "+r.toFixed(2)+"MB 】,文件较大，建议您分批次准备。":"待准备文件列表大小为【 "+(r>1?r.toFixed(2)+"MB":l.toFixed(2)+"KB")+" 】。")+"准备完成后会在右上角提示您下载!","提示",{confirmButtonText:"准备",cancelButtonText:"取消",type:r>c?"danger":"primary"}).then((function(){g({action:"downloadSrc",src:n}).then((function(t){var e=t.id;console.log("获取到下载ID："+e),i.$store.dispatch("downloadStatus/setVisible",!0),i.$notify.success({title:"提示",message:"成功创建下载任务"});var n=0;n=setInterval((function(){g({action:"queryDownload",id:e}).then((function(t){t.done&&(a.$notify.success({title:"任务下载提示",message:"您有一个任务【"+e+"】任务下载成功！"}),clearInterval(n),a.$store.dispatch("downloadStatus/setVisible",!1))}))}),2e3)}))})).catch((function(){i.$message({type:"info",message:"已取消下载"})}))},handleClickDirPath:function(t,e){for(var i="",a=0;a<=e;a++)i=i+"/"+this.dir.currentPath[a];this.handleListLenovoDir(i,"ent")},handleListLenovoDir:function(t,e){var i=this;this.dir.loadingDir=!0,g({action:"listLenovoDir",path:t.replace("+","%2B"),path_type:void 0===e?"ent":e}).then((function(t){t.result?(i.dir.tableData=[],t.data.content&&(t.data.content.forEach((function(t){t.joyeaDesc="",t.isModify=!1,i.dir.tableData.push(t)})),i.dir.currentPath=[],t.data.path.split("/").forEach((function(t){0!==t.length&&i.dir.currentPath.push(t)})))):(i.$notify.error({title:"提示",message:"文件夹列表获取失败"}),console.log("文件夹列表获取失败"+t.msg)),i.dir.loadingDir=!1}))},handleClickDirItem:function(t,e,i){this.searchTabName="dir",t.is_dir?this.handleListLenovoDir(t.path,"ent"):this.handleGoToPreview(t)},handleClickSearch:function(t,e,i){t.is_dir&&this.handleClickDirItem(t)},handleGetTopSearchKey:function(){var t=this;_().then((function(e){t.topSearchKey=e.data}))}},mounted:function(){var t=this,e=localStorage.getItem("userInfo");e&&(this.userInfo=JSON.parse(e)),this.handleListLenovoDir("/营销素材展示","ent");var i=this.$route.params.toEditList;i&&(this.toCreateAlbum.idEditMode=!0,this.toCreateAlbum.name=i.name,this.toCreateAlbum.editListId=i.id,i.list.forEach((function(e){t.$set(e,"joyeaDesc",e.desc),t.$set(e,"isModify",!1),t.toCreateAlbum.list.push(e)}))),this.handleGetTopSearchKey();var a=document.querySelector("#toSortTable .el-table__body-wrapper tbody"),n=this;Y["a"].create(a,{onEnd:function(t){var e=t.newIndex,i=t.oldIndex,a=n.toCreateAlbum.list.splice(i,1)[0];n.toCreateAlbum.list.splice(e,0,a)}})}},et=tt,it=(i("8557"),Object(s["a"])(et,q,U,!1,null,"71504905",null)),at=it.exports,nt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return 0===t.collectList.length?i("h1",{staticStyle:{color:"#303133"}},[t._v("您暂时没有收藏的资源！")]):i("section",[i("div",{staticClass:"px10_divider"},[i("el-row",t._l(t.collectList,(function(e,a){return i("el-col",{key:e.path,attrs:{md:8,xs:24}},[i("el-card",{staticStyle:{padding:"2px",margin:"5px"}},[i("img",{staticStyle:{width:"100%",height:"150px"},attrs:{src:e.url,onerror:t.defaultImg,preview:"我的收藏","preview-text":e.path}}),i("div",{staticClass:"clearfix",staticStyle:{height:"20px","margin-top":"10px"}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.path,placement:"bottom"}},[i("span",{staticClass:"svg_name"},[t._v(t._s(e.path.length>30?e.path.substr(0,30)+"...":e.path))])]),i("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(i){return t.handleDel(e,a)}}})],1)])],1)})),1)],1),i("div",{class:{no_display:0===t.collectList.length},staticStyle:{width:"100%",margin:"10px 0"}},[i("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-size":t.pageSize,"current-page":t.curPage,total:t.total},on:{"current-change":t.pageFind}})],1)])},ot=[],st={name:"collection",data:function(){return{userInfo:{},curPage:1,pageSize:15,total:0,collectList:[],defaultImg:'this.src="'+i("1fe8")+'"'}},methods:{pageFind:function(t){var e=this;g({action:"srcCollect",method:"pageFind",curPage:t,pageSize:this.pageSize}).then((function(t){if(t.result){e.curPage=t.curPage,e.pageSize=t.pageSize,e.total=t.total;var i="pic";e.collectList=[],t.list.forEach((function(t){e.collectList.push({id:t.id,url:Q(t.neid,t.hash,t.rev,i,e.userInfo.session),path:t.path})}))}else console.log(t.msg)}))},handleDel:function(t,e){var i=this;this.$alert("你即将删除：【"+t.path+"】","提示",{confirmButtonText:"确定",callback:function(a){"confirm"===a&&g({action:"srcCollect",method:"delete",id:t.id}).then((function(a){a.result?(i.$message.success("成功删除收藏:"+t.path),i.collectList.splice(e,1)):(i.$message.error("删除失败,请重新再试！"),console.log("删除失败："+a.msg))}))}})}},mounted:function(){var t=localStorage.getItem("userInfo");t&&(this.userInfo=JSON.parse(t)),this.pageFind(this.curPage)}},lt=st,rt=(i("58f6"),Object(s["a"])(lt,nt,ot,!1,null,"63c3dd26",null)),ct=(rt.exports,function(){var t=this,e=t.$createElement,i=t._self._c||e;return 0===t.albumList.length?i("h1",{staticStyle:{color:"#303133",padding:"10px"}},[t._v("您暂时没有创建的清单！")]):i("section",{staticStyle:{padding:"10px"}},[i("el-input",{staticClass:"input-with-select px10_divider",staticStyle:{display:"none"},attrs:{placeholder:"输入清单名称查找"},model:{value:t.search.key,callback:function(e){t.$set(t.search,"key",e)},expression:"search.key"}},[i("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.handleSearch},slot:"append"})],1),i("div",{staticClass:"px10_divider"},t._l(t.albumList,(function(e,a){return i("el-card",{staticStyle:{"margin-bottom":"10px"}},[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",{staticStyle:{color:"#fff","font-weight":"bold"}},[t._v(t._s(e.name))]),i("span",{staticStyle:{float:"right"}},[i("el-popover",{staticStyle:{"margin-right":"5px"},attrs:{placement:"bottom",title:"分享链接",width:"200",trigger:"hover",content:e.shared?t.domain+"/#/share?albumId="+e.id:"未分享,点击分享后可见"}},[i("el-button",{attrs:{slot:"reference",type:e.shared?"warning":"",icon:"el-icon-share",circle:"",size:"mini"},on:{click:function(e){return t.handleShare(a)}},slot:"reference"})],1),i("el-button",{attrs:{icon:"el-icon-delete",circle:"",size:"mini"},on:{click:function(e){return t.handleDelete(a)}}}),i("el-button",{attrs:{icon:"el-icon-download",circle:"",size:"mini"},on:{click:function(i){return t.handleDownloadSrc(!0,e)}}}),i("el-button",{attrs:{icon:"el-icon-edit",circle:"",size:"mini"},on:{click:function(e){return t.handleEdit(a)}}})],1)]),i("el-row",t._l(e.list,(function(a,n){return i("el-col",{attrs:{md:8,xs:24}},[i("el-card",{staticStyle:{padding:"2px",margin:"5px","text-align":"center"}},[a.mime_type.startsWith("video")?i("img",{staticClass:"album_img",attrs:{src:"video.png"},on:{click:function(e){return t.handleGoToPreview(a)}}}):a.mime_type.startsWith("doc")?i("img",{staticClass:"album_img",attrs:{src:t.handleGetDocumentImage(a.mime_type)},on:{click:function(e){return t.handleGoToPreview(a)}}}):a.mime_type.startsWith("image")?i("img",{staticClass:"album_img",attrs:{src:a.url,onerror:t.defaultImg,preview:e.name,"preview-text":"解说词："+(0===a.desc.length?"暂未设置解说词":a.desc)}}):i("img",{staticClass:"album_img",attrs:{src:"unknown.png"},on:{click:function(e){return t.handleGoToPreview(a)}}}),i("div",{staticStyle:{height:"20px","margin-top":"10px"}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:0===a.desc.length?"暂未设置解说词":a.desc,placement:"bottom"}},[i("span",{staticClass:"svg_name"},[t._v(t._s(t.getFilenameByPath(a.path)))])])],1)])],1)})),1)],1)})),1),i("el-dialog",{attrs:{title:t.toPlayVideo.title,visible:t.visible.videoDialogVisible},on:{"update:visible":function(e){return t.$set(t.visible,"videoDialogVisible",e)},close:t.handleCloseVideo,opened:function(e){return t.playVideo()}}},[i("video",{staticClass:"video-js vjs-big-play-centered vjs-fluid",attrs:{id:"myVideo",oncontextmenu:"return false"}},[i("p",{staticClass:"vjs-no-js"},[t._v(" To view this video please enable JavaScript, and consider upgrading to a web browser that "),i("a",{attrs:{href:"https://videojs.com/html5-video-support/",target:"_blank"}},[t._v(" supports HTML5 video ")])])])])],1)}),dt=[],ut={name:"list",data:function(){return{domain:window.location.protocol+"//"+window.location.host,userInfo:{},search:{key:""},visible:{videoDialogVisible:!1},toPlayVideo:{title:"",url:""},player:null,albumList:[],defaultImg:'this.src="'+i("1fe8")+'"'}},methods:{getFilenameByPath:function(t){var e=t.split("/");return e[e.length-1]},handleCloseVideo:function(){null!=this.player&&this.player.pause()},playVideo:function(){var t=this;if(null==this.player)Object(X["a"])(document.getElementById("myVideo"),{controls:!0,preload:"auto",autoplay:!1,fluid:!0,language:"zh-CN",muted:!1,inactivityTimeout:!1,controlBar:{children:[{name:"playToggle"},{name:"currentTimeDisplay"},{name:"progressControl"},{name:"durationDisplay"},{name:"volumePanel",inline:!1},{name:"FullscreenToggle"}]},sources:[{src:t.toPlayVideo.url,type:"video/mp4"}]},(function(){t.player=this}));else{var e={src:t.toPlayVideo.url,type:"video/mp4"};this.player.pause(),this.player.src(e),this.player.load(e),this.player.play()}},handlePlayVideo:function(t,e){this.visible.videoDialogVisible=!0,this.toPlayVideo.url=t,this.toPlayVideo.title=e},handleGoToPreview:function(t){var e="pic";t.mime_type.startsWith("doc")?e="doc":t.mime_type.startsWith("video")&&(e="av");var i=Q(t.neid,t.hash,t.rev,e,this.userInfo.session);t.mime_type.startsWith("video")?this.handlePlayVideo(i,t.path.substr(t.path.lastIndexOf("/")+1)):t.mime_type.startsWith("doc")?window.open(i):this.$message.error("暂不支持的预览类型！")},handleGetDocumentImage:function(t){return Z(t)},handleSearch:function(){},listAlbum:function(){var t=this;g({action:"album",method:"list"}).then((function(e){if(e.result){t.albumList=[];var i="pic";e.data.forEach((function(e){var a=[];e.src.forEach((function(e){a.push({url:Q(e.neid,e.hash,e.rev,i,t.userInfo.session),desc:e.desc,path:e.path,neid:e.neid,hash:e.hash,rev:e.rev,filename:e.filename,bytes:e.bytes,size:e.size,mime_type:e.mime_type})})),t.albumList.push({id:e.album_id,name:e.album_name,shared:e.shared,list:a})}))}else console.log(e.msg),t.$message.error("加载失败！")}))},handleDelete:function(t){var e=this;this.$alert("即将删除清单【 "+this.albumList[t].name+" 】！","删除提示",{confirmButtonText:"删除",callback:function(i){"confirm"===i&&g({action:"album",method:"delete",album_id:e.albumList[t].id}).then((function(i){i.result?(e.$message.success("清单【 "+e.albumList[t].name+" 】删除成功！"),e.albumList.splice(t,1)):e.$notify.error({title:"提示",message:"清单【 "+e.albumList[t].name+" 】删除失败！"})}))}})},handleDownloadSrc:function(t,e){var i=this,a=this,n=[],o=0;if(t){var s=0;e.list.forEach((function(t){o+=t.bytes,n.push({index:s+=1,filename:t.path.substr(t.path.lastIndexOf("/")+1),rev:t.rev,neid:t.neid.toString(),path:t.path.replace("+","%2b"),path_type:t.path_type})}))}else n.push({filename:e.path.substr(e.path.lastIndexOf("/")+1),rev:e.rev,neid:e.neid.toString(),path_type:e.path_type});var l=o/1024,r=l/1024,c=300;this.$confirm("您已选中【 "+n.length+" 】个文件，"+(r>c?"待准备文件列表大小为【 "+r.toFixed(2)+"MB 】,文件较大，建议您分批次准备。":"待准备文件列表大小为【 "+(r>1?r.toFixed(2)+"MB":l.toFixed(2)+"KB")+" 】。")+"准备完成后会在右上角提示您下载!","提示",{confirmButtonText:"准备",cancelButtonText:"取消",type:r>c?"danger":"primary"}).then((function(){w(e.id).then((function(t){console.log("record album "+e.id+" download success:"+t)})),g({action:"downloadSrc",src:n}).then((function(t){var e=t.id;console.log("获取到下载ID："+e),i.$store.dispatch("downloadStatus/setVisible",!0),i.$notify.success({title:"提示",message:"成功创建下载任务"});var n=0;n=setInterval((function(){g({action:"queryDownload",id:e}).then((function(t){t.done&&(a.$notify.success({title:"任务下载提示",message:"您有一个任务【"+e+"】任务下载成功！"}),clearInterval(n),a.$store.dispatch("downloadStatus/setVisible",!1))}))}),2e3)}))})).catch((function(){i.$message({type:"info",message:"已取消下载"})}))},handleEdit:function(t){var e=this;console.log(this.albumList[t]),this.$alert("你即将前往编辑页面，编辑【 "+this.albumList[t].name+" 】清单","提示",{confirmButtonText:"确定",callback:function(i){"confirm"===i&&e.$router.push({name:"build",params:{toEditList:e.albumList[t]}})}})},handleShare:function(t){var e=this;g({action:"album",method:this.albumList[t].shared?"unShare":"share",album_id:this.albumList[t].id}).then((function(i){i.result?e.albumList[t].shared=!e.albumList[t].shared:e.$message.error("操作失败！")}))}},mounted:function(){var t=localStorage.getItem("userInfo");t&&(this.userInfo=JSON.parse(t)),this.listAlbum()}},ht=ut,pt=(i("5740"),Object(s["a"])(ht,ct,dt,!1,null,"e276528e",null)),mt=pt.exports,ft=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"element-loading-text":"拼命加载中"}},[i("el-card",{staticStyle:{"margin-bottom":"10px"}},[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",{staticStyle:{color:"#fff","font-weight":"bold"}},[t._v(t._s(t.album.name))])]),i("el-row",t._l(t.album.list,(function(e,a){return i("el-col",{attrs:{md:8,xs:24}},[i("el-card",{staticStyle:{padding:"2px",margin:"5px","text-align":"center"}},[i("img",{staticStyle:{width:"100%","object-fit":"contain"},attrs:{src:e.url,preview:t.album.name,onerror:t.defaultImg,"preview-text":e.desc}}),i("div",{staticStyle:{height:"20px","margin-top":"10px"}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.desc,placement:"bottom"}},[i("span",{staticClass:"svg_name"},[i("b",[t._v("解说词：")]),t._v(t._s(0===e.desc.length?"暂未设置解说词":e.desc))])])],1)])],1)})),1)],1)],1)},gt=[],vt=i("118d"),bt=i.n(vt),yt={name:"share",components:{"vue-load-image":bt.a},data:function(){return{userInfo:{},loading:!1,album:{name:"",src:{}},defaultImg:'this.src="'+i("1fe8")+'"'}},methods:{},mounted:function(){var t=this;this.loading=!0;var e=this,i=this.$route.query.albumId;if(i){var a=localStorage.getItem("userInfo");a&&(this.userInfo=JSON.parse(a)),y().then((function(a){4001===a.code?(t.$router.push({name:"login",query:{ref:btoa(JSON.stringify({fromShare:!0,albumId:i}))}}),t.loading=!1):g({action:"album",method:"shareList",album_id:parseInt(i)}).then((function(i){if(i.result){var a=[],n="pic";i.album.src.forEach((function(e){a.push({url:Q(e.neid,e.hash,e.rev,n,t.userInfo.session),desc:e.desc})})),e.album.list=a,e.album.name=i.album.album_name,e.album.id=i.album.album_id}else t.$notify.error({duration:0,title:"提示",message:"获取分享信息失败："+i.msg});t.loading=!1}))}))}else this.$message.error("分享链接无效，已跳转至登录界面"),this.$router.push("/login")}},wt=yt,_t=(i("6b50"),Object(s["a"])(wt,ft,gt,!1,null,"d375fe48",null)),St=_t.exports;a["default"].use(d["a"]);var xt=new d["a"]({base:"/",routes:[{path:"/login",name:"login",desc:"登陆",component:G,hidden:!0},{path:"/share",name:"share",desc:"分享",component:St,hidden:!0},{path:"/",name:"工作台",desc:"工作台",component:F,icon:"el-icon-edit",noChild:!0,children:[{path:"/build",component:at,name:"build",desc:"制作清单"}]},{path:"/",name:"我的清单",component:F,icon:"el-icon-tickets",noChild:!0,children:[{path:"/manage/list",component:mt,name:"list",desc:"清单"}]}]}),Ct=i("5c96"),kt=i.n(Ct),Dt=(i("0fae"),i("d1d4")),It=i.n(Dt),Lt=(i("394c"),i("11f5"),i("2eee")),$t=i("92ea");i("fda2");X["a"].addLanguage("zh-CN",Lt),X["a"].addLanguage("en",$t),a["default"].config.productionTip=!1,a["default"].use(kt.a),a["default"].use(It.a),new a["default"]({router:xt,store:O,render:function(t){return t(c)}}).$mount("#app")},5740:function(t,e,i){"use strict";var a=i("13c0"),n=i.n(a);n.a},"58f6":function(t,e,i){"use strict";var a=i("e742"),n=i.n(a);n.a},"5c0b":function(t,e,i){"use strict";var a=i("2b43"),n=i.n(a);n.a},"6b50":function(t,e,i){"use strict";var a=i("2008"),n=i.n(a);n.a},8557:function(t,e,i){"use strict";var a=i("a72b"),n=i.n(a);n.a},a72b:function(t,e,i){},ba2a:function(t,e,i){"use strict";var a=i("d3be"),n=i.n(a);n.a},d289:function(t,e,i){},d3be:function(t,e,i){},e742:function(t,e,i){}});